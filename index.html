<html lang="zh-CN"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>伊蕾娜——灰之魔女</title>
    <script src="https://tailwindcss.elaina.cat/3.4.17"></script>
    <link href="https://cdn.jsdmirror.com/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdmirror.com/npm/lxgw-wenkai-webfont@1.7.0/lxgwwenkai-regular.css">
    <!-- 引入Waline样式 -->
    <link rel="stylesheet" href="https://cdn.jsdmirror.com/npm/@waline/client@v2/dist/waline.css" />
    
    <!-- 音乐播放器所需资源 -->
    <link rel="stylesheet" href="https://cdn.jsdmirror.com/npm/aplayer@1.10.1/dist/APlayer.min.css">
    <script src="https://cdn.jsdmirror.com/npm/aplayer@1.10.1/dist/APlayer.min.js"></script>
    <script src="https://cdn.jsdmirror.com/npm/meting2@0.0.1/js/Meting.min.js"></script>
    
    <style>
        /* 全局字体样式 */
        * {
            font-family: 'LXGW WenKai';
            font-weight: bold;
        }

        body {
            font-family: 'LXGW WenKai';
        }
        
        /* 评论区加载动画 */
        .waline-loading {
            text-align: center;
            padding: 2rem;
        }
        .waline-loading i {
            animation: spin 1.5s linear infinite;
            font-size: 2rem;
            color: #6b46c1;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* 恢复Waline默认按钮样式，保持原始提交按钮颜色 */
        .waline-container .wl-btn {
            @apply text-white;
        }
        /* 单独设置评论提交按钮为原始样式 */
        .waline-container .wl-editor .wl-btn[type="submit"] {
            background-color: #42b983 !important;
            border-color: #42b983 !important;
        }
        .waline-container .wl-editor .wl-btn[type="submit"]:hover {
            background-color: #359469 !important;
            border-color: #359469 !important;
        }
        
        /* 音乐播放器样式调整 */
        .aplayer {
            --aplayer-color: #6b46c1 !important;
            --aplayer-background: #ffffff !important;
            --aplayer-text: #2d3748 !important;
            --aplayer-cover-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
            transition: all 0.3s ease !important;
        }

        /* 音乐播放器进一步进行隐藏 */
        .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
            left: -66px !important;
        }
        .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
            left: 0 !important;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6b46c1',
                        secondary: '#44337a',
                        accent: '#e9d8fd',
                        dark: '#2d3748',
                        title: '#5d4037' // 标题颜色
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            }
            .bg-gradient-magic {
                background: linear-gradient(135deg, #6b46c1 0%, #44337a 100%);
            }
            .transition-smooth {
                transition: all 0.3s ease-in-out;
            }
            .carousel-indicator {
                width: 10px;
                height: 10px;
                border-radius: 50%;
                cursor: pointer;
                transition: all 0.3s ease;
            }
            .carousel-indicator.active {
                width: 30px;
                border-radius: 5px;
            }
            .carousel-container {
                aspect-ratio: 16/9; /* 横版图片标准比例 */
                overflow: hidden;
            }
            .carousel-image {
                object-fit: contain; /* 确保图片完整显示 */
                height: 100%;
                width: 100%;
                background-color: #f3f4f6; /* 添加背景色 */
                cursor: zoom-in; /* 显示放大图标 */
            }
            /* 图片查看器样式 */
            .image-viewer {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.9);
                display: none;
                justify-content: center;
                align-items: center;
                z-index: 100;
                padding: 20px;
            }
            .image-viewer.active {
                display: flex;
            }
            .viewer-content {
                position: relative;
                max-width: 100%;
                max-height: 100%;
            }
            .viewer-image {
                max-width: 100%;
                max-height: 85vh;
                object-fit: contain;
            }
            .close-btn {
                position: absolute;
                top: -40px;
                right: 0;
                color: white;
                background: none;
                border: none;
                font-size: 24px;
                cursor: pointer;
                width: 40px;
                height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.3s ease;
            }
            .close-btn:hover {
                transform: scale(1.2);
            }
            /* 图片导航按钮 */
            .viewer-nav {
                position: absolute;
                top: 50%;
                width: 100%;
                display: flex;
                justify-content: space-between;
                transform: translateY(-50%);
                pointer-events: none;
            }
            .viewer-nav-btn {
                color: white;
                background: rgba(0, 0, 0, 0.5);
                border: none;
                font-size: 32px;
                cursor: pointer;
                width: 60px;
                height: 60px;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 50%;
                margin: 0 10px;
                transition: all 0.3s ease;
                pointer-events: auto;
            }
            .viewer-nav-btn:hover {
                background: rgba(0, 0, 0, 0.8);
            }
            /* 菜单动画 */
            .menu-enter {
                opacity: 0;
                transform: translateY(-10px);
            }
            .menu-enter-active {
                opacity: 1;
                transform: translateY(0);
                transition: opacity 0.3s ease, transform 0.3s ease;
            }
            /* 评论区样式优化 */
            .waline-container {
                transition: all 0.3s ease;
            }
            .waline-container .wl-comments,
            .waline-container .wl-editor {
                @apply rounded-lg border-gray-200;
            }
            .waline-container .wl-count {
                @apply text-xl font-bold text-title mb-4;
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans transition-smooth">
    <!-- 图片查看器 (默认隐藏) -->
    <div id="image-viewer" class="image-viewer">
        <div class="viewer-content">
            <button id="viewer-close" class="close-btn">
                <i class="fa fa-times"></i>
            </button>
            <img id="viewer-image" class="viewer-image" src="" alt="伊蕾娜大图">
            <div class="viewer-nav">
                <button id="viewer-prev" class="viewer-nav-btn">
                    <i class="fa fa-chevron-left"></i>
                </button>
                <button id="viewer-next" class="viewer-nav-btn">
                    <i class="fa fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- 语言切换器 - 左上角 -->
    <div class="fixed top-4 left-4 z-50 bg-white/80 backdrop-blur-sm rounded-full shadow-lg p-2 flex space-x-1 h-10 items-center">
        <button id="lang-zh" class="lang-btn px-3 py-1 rounded-full bg-black text-white transition-smooth">中文</button>
        <button id="lang-en" class="lang-btn px-3 py-1 rounded-full hover:bg-gray-200 transition-smooth">English</button>
        <button id="lang-ca" class="lang-btn px-3 py-1 rounded-full hover:bg-gray-200 transition-smooth">Català</button>
    </div>

    <!-- 右上角功能按钮 -->
    <div class="fixed top-4 right-4 z-50 bg-white/80 backdrop-blur-sm rounded-full shadow-lg p-2 flex space-x-1 h-10 items-center">
        <button id="menu-btn" class="function-btn px-3 py-1 rounded-full hover:bg-gray-200 transition-smooth" title="菜单">
            <i class="fa fa-bars"></i>
        </button>
    </div>

    <!-- 菜单 (默认隐藏) - 向下弹出 -->
    <div id="menu-container" class="fixed top-16 right-4 z-40 bg-white rounded-xl shadow-lg w-48 hidden menu-enter">
        <ul class="py-2">
            <li><a href="https://img.elaina.cat" class="block px-4 py-2 hover:bg-gray-100 transition-smooth" data-i18n="menuImgBed">图床</a></li>
            <li><a href="https://pan.elaina.cat" class="block px-4 py-2 hover:bg-gray-100 transition-smooth" data-i18n="menuCloudDrive">云盘</a></li>
            <li><a href="https://api.elaina.cat/" class="block px-4 py-2 hover:bg-gray-100 transition-smooth" data-i18n="menuRandomImageApi">随机图片API</a></li>
            <li><a href="https://mail.elaina.cat" class="block px-4 py-2 hover:bg-gray-100 transition-smooth" data-i18n="menuFreeEmail">免费邮箱</a></li>
        </ul>
    </div>

    <!-- 页面容器 -->
    <div class="container mx-auto px-4 py-16 max-w-5xl">
        <!-- 内容部分 -->
        <div class="flex flex-col gap-8">
            <!-- 图片轮播部分 -->
            <div class="relative rounded-xl shadow-xl carousel-container w-full">
                <!-- 轮播图片容器 -->
                <div id="carousel" class="flex transition-transform duration-500 ease-in-out h-full">
                    <img src="https://cdn.elaina.cat/image/5.jpg" alt="伊蕾娜1 - 戴着三角帽的魔女" class="w-full flex-shrink-0 carousel-image" data-img-index="0">
                    <img src="https://cdn.elaina.cat/image/3.jpg" alt="伊蕾娜2 - 灰之魔女" class="w-full flex-shrink-0 carousel-image" data-img-index="1">
                    <img src="https://cdn.elaina.cat/image/4.jpg" alt="伊蕾娜3 - 旅行中的魔女" class="w-full flex-shrink-0 carousel-image" data-img-index="2">
                    <img src="https://cdn.elaina.cat/image/2.jpg" alt="伊蕾娜4 - 魔法时刻" class="w-full flex-shrink-0 carousel-image" data-img-index="3">
                    <img src="https://cdn.elaina.cat/image/1.jpg" alt="伊蕾娜5 - 小时候的伊雷娜" class="w-full flex-shrink-0 carousel-image" data-img-index="4">
                </div>
                
                <!-- 轮播控制按钮 -->
                <button id="prev-btn" class="absolute left-4 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white w-10 h-10 rounded-full flex items-center justify-center transition-smooth z-10">
                    <i class="fa fa-chevron-left"></i>
                </button>
                <button id="next-btn" class="absolute right-4 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white w-10 h-10 rounded-full flex items-center justify-center transition-smooth z-10">
                    <i class="fa fa-chevron-right"></i>
                </button>
                
                <!-- 轮播指示器 -->
                <div class="absolute bottom-4 left-0 right-0 flex justify-center space-x-2 z-10">
                    <div class="carousel-indicator active bg-white" data-index="0"></div>
                    <div class="carousel-indicator bg-white/50" data-index="1"></div>
                    <div class="carousel-indicator bg-white/50" data-index="2"></div>
                    <div class="carousel-indicator bg-white/50" data-index="3"></div>
                    <div class="carousel-indicator bg-white/50" data-index="4"></div>
                </div>
            </div>

            <!-- 标题部分 -->
            <header class="text-center mt-8 mb-4">
                <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold mb-4 text-title text-shadow" data-i18n="title">伊蕾娜——灰之魔女</h1>
            </header>

            <!-- 文本部分 -->
            <div class="bg-white rounded-2xl shadow-lg p-8">
                <p class="text-lg mb-6 leading-relaxed" data-i18n="description1">
                    伊蕾娜（日语：イレイナ）是于2014年开始连载，由日本轻小说作家白石定规著作、插画家あずーる负责插画的轻小说《魔女之旅》及其衍生作品中的主角，其魔女名为“灰之魔女”。伊蕾娜的生日为10月17日。
                </p>
                <p class="text-lg mb-6 leading-relaxed" data-i18n="description2">
                    伊蕾娜留有一头灰白长发，披着黑色长袍，戴着三角帽，胸口别有象征魔女的胸针“星形胸饰”。伊蕾娜因向往幼时读过的小说集《妮可冒险记》中名为妮可的魔女的生活而想要和她一样去往世界各地旅行。她在14岁时拜星辰魔女芙兰为师，并在一年后便成为最高阶魔法师，获得“魔女”称号。成为魔女后，伊蕾娜环游世界各地，在旅途中她帮助了很多人，并且收下沙耶为徒，送给了她一顶魔女帽。
                </p>
                <p class="text-lg leading-relaxed" data-i18n="description3">伊蕾娜虽然年纪轻轻，但努力工作并精通所有魔法，性格沉稳认真，同时也充满好奇。因为向往着幼时读过的旅行故事，伊蕾娜随意地进行着漫长的旅行。她在这个广阔的世界里自由地漫步，接触着形形色色有趣的人，体味着人们美好的日常生活。作为一名旅人，伊蕾娜不带有任何目的地接触着各种国家的各色人群。</p>
            </div>

            <!-- Waline 评论框 -->
            <div class="bg-white rounded-2xl shadow-lg p-8 mt-8 waline-container">
                <h2 class="text-2xl font-bold mb-6 text-title" data-i18n="commentsTitle">评论区</h2>
                <div id="waline">
                    <!-- 加载动画 -->
                    <div class="waline-loading">
                        <i class="fa fa-circle-o-notch"></i>
                        <p class="mt-2" data-i18n="loadingComments">加载评论中...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 页脚 -->
        <footer class="mt-16 text-center text-gray-500 text-sm">
            <p data-i18n="footer">© 2025 elaina.cat</p>
            <p class="mt-1"><a href="https://icp.gov.moe/?keyword=20251799" target="_blank" class="hover:text-primary transition-smooth">萌ICP备20251799号</a></p>
        </footer>
    </div>

    <!-- 音乐播放器 -->
    <meting-js 
        fixed="true" 
        autoplay="false" 
        theme="#6b46c1" 
        list-folded="true" 
        auto="https://music.163.com/#/song?id=1487170615">
    </meting-js>

    <!-- 引入 Waline JS -->
    <script src="https://cdn.jsdmirror.com/npm/@waline/client@2/dist/waline.js"></script>

    <script>
        // 多语言文本数据
        const translations = {
            zh: {
                title: "伊蕾娜——灰之魔女",
                description1: "伊蕾娜（日语：イレイナ）是于2014年开始连载，由日本轻小说作家白石定规著作、插画家あずーる负责插画的轻小说《魔女之旅》及其衍生作品中的主角，其魔女名为“灰之魔女”。伊蕾娜的生日为10月17日。",
                description2: "伊蕾娜留有一头灰白长发，披着黑色长袍，戴着三角帽，胸口别有象征魔女的胸针“星形胸饰”。伊蕾娜因向往幼时读过的小说集《妮可冒险记》中名为妮可的魔女的生活而想要和她一样去往世界各地旅行。她在14岁时拜星辰魔女芙兰为师，并在一年后便成为最高阶魔法师，获得“魔女”称号。成为魔女后，伊蕾娜环游世界各地，在旅途中她帮助了很多人，并且收下沙耶为徒，送给了她一顶魔女帽。",
                description3: "伊蕾娜虽然年纪轻轻，但努力工作并精通所有魔法，性格沉稳认真，同时也充满好奇。因为向往着幼时读过的旅行故事，伊蕾娜随意地进行着漫长的旅行。她在这个广阔的世界里自由地漫步，接触着形形色色有趣的人，体味着人们美好的日常生活。作为一名旅人，伊蕾娜不带有任何目的地接触着各种国家的各色人群。",
                footer: "© 2025 elaina.cat",
                menuImgBed: "图床",
                menuCloudDrive: "云盘",
                menuRandomImageApi: "随机图片API",
                menuFreeEmail: "免费邮箱",
                commentsTitle: "评论区",
                loadingComments: "加载评论中...",
                walinePlaceholder: "请注意：提交留言后，内容需审核通过后才会展示，请勿重复发布。"
            },
            en: {
                title: "Elaina —— The Ashen Witch",
                description1: "Elaina (Japanese: イレイナ) is the protagonist of the light novel series \"Majo no Tabitabi\" (Witch's Journey) and its derivatives, which began serialization in 2014. Written by Japanese light novelist Jougi Shiraishi and illustrated by Azuru, her witch name is \"The Ashen Witch\". Elaina's birthday is October 17th.",
                description2: "Elaina has long grayish-white hair, wears a black robe, a triangular hat, and a star-shaped brooch on her chest that symbolizes a witch. Inspired by the life of the witch Niko from the novel collection \"Niko's Adventures\" she read as a child, Elaina desired to travel the world like her. At 14, she became a disciple of Fran, the Star Witch, and within a year became a high-ranking magician, earning the title of \"Witch\". After becoming a witch, Elaina traveled around the world, helping many people on her journey, taking Saya as her disciple, and giving her a witch's hat.",
                description3: "Despite her young age, Elaina works hard, is proficient in all magic, has a calm and serious personality, and is full of curiosity. Inspired by the travel stories she read as a child, Elaina embarks on a long, unstructured journey. She wanders freely in this vast world, encountering various interesting people and experiencing the beauty of everyday life. As a traveler, Elaina approaches people from different countries and backgrounds without any specific purpose.",
                footer: "© 2025 elaina.cat",
                menuImgBed: "Image Host",
                menuCloudDrive: "Cloud Storage",
                menuRandomImageApi: "Random Image API",
                menuFreeEmail: "Free Email",
                commentsTitle: "Comments",
                loadingComments: "Loading comments...",
                walinePlaceholder: "Note: Comments will be displayed after review. Please do not repost."
            },
            ca: {
                title: "Elaina —— La Bruixa Cendra",
                description1: "Elaina (en japonès: イレイナ) és la protagonista de la novel·la lleugera japonesa El viatge de la bruixa i les seves obres derivades, començada el 2014, escrita per l’autor Jōgi Shiraishi i amb il·lustracions d’Azuru. El seu nom de bruixa és “la Bruixa de Cendra”. L’aniversari d’Elaina és el 17 d’octubre.",
                description2: "Elaina té una llarga cabellera grisa i blanca, porta una túnica negra i un barret de tres puntes, i al pit duu un fermall en forma d’estrella que simbolitza les bruixes. Va decidir viatjar pel món inspirada per la vida de Nique, una bruixa del recull de novel·les Les aventures de Nique que havia llegit quan era petita.",
                description3: "Tot i ser molt jove, Elaina treballa amb esforç i és mestra de tota mena de màgia; té un caràcter serè i responsable, però alhora està plena de curiositat. Atreta pels relats de viatges que havia llegit de petita, Elaina emprèn amb lleugeresa un llarg viatge. En aquest món tan vast, passeja amb llibertat, coneixent tota mena de persones interessants i assaborint la bellesa de la vida quotidiana de la gent. Com a viatgera, Elaina no té cap destinació concreta, sinó que es relaciona amb persones de països i pobles molt diversos.",
                footer: "© 2025 elaina.cat",
                menuImgBed: "Xarxa d'imatges",
                menuCloudDrive: "Disc en núvol",
                menuRandomImageApi: "API d'imatges aleatòries",
                menuFreeEmail: "Correu gratuït",
                commentsTitle: "Comentaris",
                loadingComments: "Carregant comentaris...",
                walinePlaceholder: "Nota: Els comentaris es mostraran després de ser revisats. No torneu a publicar."
            }
        };

        // 存储当前Waline实例
        let walineInstance = null;
        
        // 初始化Waline评论系统
        function initWaline(lang = 'zh') {
            // 如果已有实例，先销毁
            if (walineInstance) {
                walineInstance.destroy();
            }
            
            // 获取当前页面路径
            const path = window.location.pathname || '/';
            
            // 初始化新实例
            walineInstance = Waline.init({
                el: '#waline',
                serverURL: 'https://waline.elaina.cat/',
                path: path,
                emoji: [
                    'https://cdn.jsdmirror.com/gh/walinejs/emojis@1.0.0/weibo',
                ],
                imageUploader: false,
                search: false,
                login: "disable",
                noCopyright: false,
                wordLimit: 1024,
                comment: true,
                pageview: true,
                reaction: [
                    "https://npm.elemecdn.com/@waline/emojis@1.1.0/bilibili/bb_heart_eyes.png",
                    "https://npm.elemecdn.com/@waline/emojis@1.1.0/bilibili/bb_thumbsup.png",
                    "https://npm.elemecdn.com/@waline/emojis@1.1.0/bilibili/bb_zhoumei.png",
                    "https://npm.elemecdn.com/@waline/emojis@1.1.0/bilibili/bb_grievance.png",
                    "https://npm.elemecdn.com/@waline/emojis@1.1.0/bilibili/bb_dizzy_face.png",
                    "https://npm.elemecdn.com/@waline/emojis@1.1.0/bilibili/bb_slap.png",
                ],
                locale: {
                    placeholder: translations[lang].walinePlaceholder,
                    reaction0: "非常有用",
                    reaction1: "有帮助",
                    reaction2: "一般",
                    reaction3: "无帮助",
                    reaction4: "看不懂",
                    reaction5: "有错误",
                    reactionTitle: "本站内容对你有帮助吗？",
                    sofa: "还没有人留言哦！快来抢沙发吧~",
                    comment: "留言",
                },
            });
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 语言切换相关元素
            const langButtons = document.querySelectorAll('.lang-btn');
            const menuBtn = document.getElementById('menu-btn');
            const menuContainer = document.getElementById('menu-container');
            
            // 轮播相关元素
            const carousel = document.getElementById('carousel');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const indicators = document.querySelectorAll('.carousel-indicator');
            const slides = carousel.querySelectorAll('img');
            let currentIndex = 0;
            let slideInterval = null;
            const slideDelay = 5000; // 5秒切换一次
            let isTransitioning = false; // 跟踪过渡状态
            
            // 图片查看器相关元素
            const imageViewer = document.getElementById('image-viewer');
            const viewerImage = document.getElementById('viewer-image');
            const viewerClose = document.getElementById('viewer-close');
            const viewerPrev = document.getElementById('viewer-prev');
            const viewerNext = document.getElementById('viewer-next');
            
            // 自动检测浏览器语言
            function detectBrowserLanguage() {
                const browserLang = navigator.language || navigator.userLanguage;
                if (browserLang.startsWith('zh')) {
                    return 'zh';
                } else if (browserLang.startsWith('ca')) {
                    return 'ca';
                } else {
                    return 'en';
                }
            }
            
            // 根据检测到的语言自动切换
            const defaultLang = detectBrowserLanguage();
            switchLanguage(defaultLang);
            
            // 初始化评论系统
            initWaline(defaultLang);
            
            // 语言切换函数
            function switchLanguage(lang) {
                // 更新按钮样式
                langButtons.forEach(btn => {
                    btn.classList.remove('bg-black', 'text-white');
                    btn.classList.add('hover:bg-gray-200');
                });
                document.getElementById(`lang-${lang}`).classList.add('bg-black', 'text-white');
                document.getElementById(`lang-${lang}`).classList.remove('hover:bg-gray-200');
                
                // 更新页面文本
                document.querySelectorAll('[data-i18n]').forEach(element => {
                    const key = element.getAttribute('data-i18n');
                    element.textContent = translations[lang][key];
                });
                
                // 更新评论区语言
                initWaline(lang);
            }
            
            // 菜单按钮功能 - 添加动画效果
            menuBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                
                // 切换菜单显示状态
                if (menuContainer.classList.contains('hidden')) {
                    // 显示菜单并添加动画
                    menuContainer.classList.remove('hidden');
                    // 触发重排后添加激活类以启动动画
                    setTimeout(() => {
                        menuContainer.classList.add('menu-enter-active');
                    }, 10);
                } else {
                    // 隐藏菜单并移除动画类
                    menuContainer.classList.remove('menu-enter-active');
                    setTimeout(() => {
                        menuContainer.classList.add('hidden');
                    }, 300); // 等待动画完成
                }
            });
            
            // 点击页面其他地方关闭菜单
            document.addEventListener('click', function() {
                if (!menuContainer.classList.contains('hidden')) {
                    menuContainer.classList.remove('menu-enter-active');
                    setTimeout(() => {
                        menuContainer.classList.add('hidden');
                    }, 300);
                }
            });
            
            // 防止点击菜单内部时关闭
            menuContainer.addEventListener('click', function(e) {
                e.stopPropagation();
            });
            
            // 绑定语言按钮点击事件
            langButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const lang = this.id.split('-')[1];
                    switchLanguage(lang);
                });
            });
            
            // 轮播功能
            function showSlide(index) {
                // 确保索引在有效范围内
                if (index < 0) {
                    currentIndex = slides.length - 1;
                } else if (index >= slides.length) {
                    currentIndex = 0;
                } else {
                    currentIndex = index;
                }
                
                // 移动轮播
                const slideWidth = 100; // 百分比
                carousel.style.transform = `translateX(-${currentIndex * slideWidth}%)`;
                
                // 更新指示器
                indicators.forEach((indicator, i) => {
                    if (i === currentIndex) {
                        indicator.classList.add('active', 'bg-white');
                        indicator.classList.remove('bg-white/50');
                    } else {
                        indicator.classList.remove('active', 'bg-white');
                        indicator.classList.add('bg-white/50');
                    }
                });
            }
            
            // 下一张幻灯片
            function nextSlide() {
                if (isTransitioning) return;
                isTransitioning = true;
                
                showSlide(currentIndex + 1);
            }
            
            // 上一张幻灯片
            function prevSlide() {
                if (isTransitioning) return;
                isTransitioning = true;
                
                showSlide(currentIndex - 1);
            }
            
            // 设置自动轮播 - 改进版
            function startSlideInterval() {
                // 先清除任何已存在的定时器
                if (slideInterval) {
                    clearInterval(slideInterval);
                }
                
                // 创建新的定时器
                slideInterval = setInterval(() => {
                    // 确保页面可见且轮播可用
                    if (document.visibilityState === 'visible' && 
                        carousel && !carousel.closest('.hidden') && 
                        !isTransitioning) {
                        nextSlide();
                    }
                }, slideDelay);
            }
            
            // 停止自动轮播
            function stopSlideInterval() {
                if (slideInterval) {
                    clearInterval(slideInterval);
                    slideInterval = null;
                }
            }
            
            // 过渡结束后重新启用控制
            carousel.addEventListener('transitionend', () => {
                isTransitioning = false;
            });
            
            // 绑定轮播控制事件，增加防抖处理
            prevBtn.addEventListener('click', function() {
                if (isTransitioning) return;
                
                stopSlideInterval();
                prevSlide();
                // 重置计时器，确保从当前图片开始计时
                setTimeout(startSlideInterval, slideDelay);
            });
            
            nextBtn.addEventListener('click', function() {
                if (isTransitioning) return;
                
                stopSlideInterval();
                nextSlide();
                // 重置计时器
                setTimeout(startSlideInterval, slideDelay);
            });
            
            // 绑定指示器点击事件
            indicators.forEach(indicator => {
                indicator.addEventListener('click', function() {
                    if (isTransitioning) return;
                    
                    const index = parseInt(this.getAttribute('data-index'));
                    // 如果点击的是当前索引，不做任何操作
                    if (index === currentIndex) return;
                    
                    stopSlideInterval();
                    showSlide(index);
                    // 重置计时器
                    setTimeout(startSlideInterval, slideDelay);
                });
            });
            
            // 鼠标悬停时暂停轮播，离开时恢复
            const carouselContainer = carousel.parentElement;
            carouselContainer.addEventListener('mouseenter', stopSlideInterval);
            carouselContainer.addEventListener('mouseleave', () => {
                // 离开时重置计时器，确保从当前图片开始计时
                if (slideInterval) {
                    clearInterval(slideInterval);
                }
                setTimeout(startSlideInterval, slideDelay);
            });
            
            // 页面可见性变化时管理轮播
            document.addEventListener('visibilitychange', () => {
                if (document.visibilityState === 'visible') {
                    // 页面重新可见时，从当前图片开始计时
                    startSlideInterval();
                } else {
                    // 页面不可见时停止轮播
                    stopSlideInterval();
                }
            });
            
            // 开始自动轮播
            startSlideInterval();
            
            // 图片查看器功能
            function openImageViewer(index) {
                // 暂停轮播
                stopSlideInterval();
                
                // 更新查看器图片
                const image = slides[index];
                viewerImage.src = image.src;
                viewerImage.alt = image.alt;
                
                // 显示查看器
                imageViewer.classList.add('active');
                
                // 记录当前查看的图片索引
                viewerImage.setAttribute('data-current-index', index);
                
                // 防止页面滚动
                document.body.style.overflow = 'hidden';
            }
            
            function closeImageViewer() {
                // 隐藏查看器
                imageViewer.classList.remove('active');
                
                // 恢复页面滚动
                document.body.style.overflow = 'auto';
                
                // 重新开始轮播，从当前图片开始计时
                setTimeout(startSlideInterval, slideDelay);
            }
            
            function showNextInViewer() {
                let currentIndex = parseInt(viewerImage.getAttribute('data-current-index'));
                currentIndex = (currentIndex + 1) % slides.length;
                openImageViewer(currentIndex);
            }
            
            function showPrevInViewer() {
                let currentIndex = parseInt(viewerImage.getAttribute('data-current-index'));
                currentIndex = (currentIndex - 1 + slides.length) % slides.length;
                openImageViewer(currentIndex);
            }
            
            // 点击轮播图片打开查看器
            slides.forEach((slide, index) => {
                slide.addEventListener('click', function() {
                    openImageViewer(index);
                });
            });
            
            // 关闭查看器
            viewerClose.addEventListener('click', closeImageViewer);
            
            // 点击查看器背景关闭
            imageViewer.addEventListener('click', function(e) {
                if (e.target === imageViewer) {
                    closeImageViewer();
                }
            });
            
            // 查看器中的导航按钮
            viewerNext.addEventListener('click', function(e) {
                e.stopPropagation();
                showNextInViewer();
            });
            
            viewerPrev.addEventListener('click', function(e) {
                e.stopPropagation();
                showPrevInViewer();
            });
            
            // 键盘导航
            document.addEventListener('keydown', function(e) {
                if (imageViewer.classList.contains('active')) {
                    if (e.key === 'Escape') {
                        closeImageViewer();
                    } else if (e.key === 'ArrowRight') {
                        showNextInViewer();
                    } else if (e.key === 'ArrowLeft') {
                        showPrevInViewer();
                    }
                }
            });
        });
    </script>
</body></html>
